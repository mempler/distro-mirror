services:
  arch-mirror:
    build: ./arch
    ports:
      - "20450:80"
    volumes:
      - arch_data:/var/www/arch
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == worker
        preferences:
          - spread: node.labels.zone
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 1G
    networks:
      - mirror_network

  ubuntu-mirror:
    build: ./ubuntu
    ports:
      - "20451:80"
    volumes:
      - ubuntu_data:/var/www/ubuntu
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == worker
        preferences:
          - spread: node.labels.zone
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 1G
    networks:
      - mirror_network

volumes:
  arch_data:
  ubuntu_data:

networks:
  mirror_network:
    driver: overlay
